<div id="body" xmlns="http://www.w3.org/1999/html">
  <mat-toolbar color="primary">
    <div>
      <button mat-icon-button (click)="sidenav.toggle()">
        <mat-icon>menu</mat-icon>
      </button>
    </div>

    <span class="title">Welcome, {{user.name}}</span>
    <span class="example-spacer"></span>

  </mat-toolbar>
  <mat-sidenav-container class="example-container">

    <mat-sidenav  #sidenav  mode="over"  opened="false" >
      <div>
        <a mat-button (click)="setProfile()">Profile</a>
        <a mat-button (click)="setManageLocations()">Manage locations</a>
        <a mat-button (click)="setPastAction()">Past action</a>
        <a mat-button (click)="setSecurity()">Security</a>
        <a mat-button class="bottom" (click)="logOut()">Logout</a>
      </div>
    </mat-sidenav>
    <mat-sidenav-content >
      <!--ngIf for each section -->
      <div class="profile" *ngIf="isProfile()">
        <h1>Profile</h1>
        <table class="data" cellspacing="0">
          <tr><td class="left">Name:</td><td class="right">{{user.name}}</td> </tr>

          <tr><td class="left">Surname:</td><td class="right">{{user.surname}}</td> </tr>

          <tr><td class="left">Email:</td><td class="right">{{user.email}}</td> </tr>

          <tr><td class="left">Phone number:</td><td class="right">{{user.phoneNumber}}</td> </tr>
        </table>
      </div>

      <div class="security" *ngIf="isSecurity()">
        <!-- divided into 2 sections: password and sessios-->
        <div class="password">
        <h1>Change password</h1>
          <p class="label">Old password:</p>
          <p class="input"><input #oldPassword type="password"></p>
          <p class="label">New password:</p>
          <p class="input"><input #newPassword type="password"></p>
          <p class="label">Confirm password:</p>
          <p class="input"><input #confirmPassword type="password"></p>
        <a mat-button (click)="changePassword2(oldPassword.value,newPassword.value,confirmPassword.value)">Confirm</a>
        <br>
        </div>
        <div class="sessions">
        <h1>Sessions</h1>
        <!--Sessions table-->
          <!--filter field-->
          <mat-form-field class="actions-form-field">
            <mat-label>Filter logs</mat-label>
            <input matInput (keyup)="applyFilterLogs($event)" #input>
          </mat-form-field>
          <!--table-->
          <table mat-table [dataSource]="dataSourceLogs" matSort matSortActive="created" matSortDisableClear matSortDirection="desc" class="pastActionsTable">
            <!-- IP Column -->
            <ng-container matColumnDef="ip">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> IP </th>
              <td mat-cell *matCellDef="let element"> {{element.ip}} </td>
            </ng-container>

            <!-- Browser Column -->
            <ng-container matColumnDef="browser">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Browser </th>
              <td mat-cell *matCellDef="let element"> {{element.browser}} </td>
            </ng-container>

            <!-- Browser version Column -->
            <ng-container matColumnDef="browserVersion">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Browser Version </th>
              <td mat-cell *matCellDef="let element"> {{element.browserVersion}} </td>
            </ng-container>

            <!-- Device Column -->
            <ng-container matColumnDef="device">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Device </th>
              <td mat-cell *matCellDef="let element"> {{element.device}} </td>
            </ng-container>

            <!-- OS Column -->
            <ng-container matColumnDef="os">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> OS </th>
              <td mat-cell *matCellDef="let element"> {{element.os}} </td>
            </ng-container>

            <!-- OS version Column -->
            <ng-container matColumnDef="osVersion">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> OS version </th>
              <td mat-cell *matCellDef="let element"> {{element.osVersion}} </td>
            </ng-container>

            <!-- DateTime Column -->
            <ng-container matColumnDef="dateTime">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Date&Time </th>
              <td mat-cell *matCellDef="let element"> {{element.dateTime}} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumnsLogs"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumnsLogs;"></tr>
          </table>
          <mat-paginator [length]="resultLengthLogs" [pageSize]="5" [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
          </div>
      </div>

      <div class="manageLocations" *ngIf="isManageLocations()">
        <mat-form-field class="location-form-field">
          <mat-label>Filter locations</mat-label>
          <label>
            <input matInput (keyup)="applyFilter($event, locationDataSource)" placeholder="Ex. home" class="filter-locations">
          </label>
        </mat-form-field>
        <table mat-table
               [dataSource]="locationDataSource" multiTemplateDataRows
               class="mat-elevation-z8">
          <ng-container matColumnDef="{{column}}" *ngFor="let column of locationColumns">
            <th mat-header-cell *matHeaderCellDef> {{column}} </th>
            <td mat-cell *matCellDef="let location"> {{location[column]}} </td>
          </ng-container>

          <ng-container matColumnDef="expandedDetail">
            <td mat-cell *matCellDef="let location" [attr.colspan]="locationColumns.length">
              <div class="location-detail"
                   [@detailExpand]="location == expandedLocation ? 'expanded' : 'collapsed'">
                <div class="room-table-wrapper">
                  <mat-form-field class="room-form-field">
                    <mat-label class="room-filter-label">Filter rooms</mat-label>
                    <label>
                      <input matInput (keyup)="applyFilter($event, roomDataSource)" placeholder="Ex. kitchen" class="filter-rooms">
                    </label>
                  </mat-form-field>
                  <table mat-table
                         [dataSource]="roomDataSource" multiTemplateDataRows
                         class="room-table">
                    <ng-container matColumnDef="{{column}}" *ngFor="let column of roomColumns">
                      <th mat-header-cell *matHeaderCellDef> {{column}} </th>
                      <td mat-cell *matCellDef="let room"> {{room[column]}} </td>
                    </ng-container>

                    <ng-container matColumnDef="Update">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let room">

                        <!-- This is where we have to add the function to update the room -->
                        <button (click)="updateRoom()" mat-button color="basic" aria-label="Update room" matTooltip="Update room">
                          <mat-icon>create</mat-icon>
                        </button>

                      </td>
                    </ng-container>

                    <ng-container matColumnDef="Delete">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let room">

                        <!-- This is where we have to add the function to delete the room -->
                        <button (click)="deleteRoom()" mat-button color="warn" aria-label="Delete room" matTooltip="Delete room">
                          <mat-icon>delete</mat-icon>
                        </button>

                      </td>
                    </ng-container>

                    <ng-container matColumnDef="expandedRoom">
                      <td mat-cell *matCellDef="let room" [attr.colspan]="roomColumns.concat(['Update', 'Delete']).length">
                        <div class="location-detail"
                             [@detailExpand]="room == expandedRoom ? 'expanded' : 'collapsed'">

                          <div class="controller-table-wrapper">
                            <mat-form-field class="room-form-field">
                              <mat-label class="room-filter-label">Filter controllers</mat-label>
                              <label>
                                <input matInput (keyup)="applyFilter($event, controllerDataSource)" placeholder="Ex. door" class="filter-rooms">
                              </label>
                            </mat-form-field>

                            <table mat-table
                                   [dataSource]="controllerDataSource" multiTemplateDataRows
                                   class="controller-table">
                              <ng-container matColumnDef="{{column}}" *ngFor="let column of controllerColumns">
                                <th mat-header-cell *matHeaderCellDef> {{column}} </th>
                                <td mat-cell *matCellDef="let controller"> {{controller[column]}} </td>
                              </ng-container>

                              <ng-container matColumnDef="Update">
                                <th mat-header-cell *matHeaderCellDef></th>
                                <td mat-cell *matCellDef="let controller">

                                  <!-- This is where we have to add the function to update the controller -->
                                  <button mat-button color="basic" aria-label="Update controller" matTooltip="Update controller" (click)="UpdateGSM(controller)">
                                    <mat-icon>create</mat-icon>
                                  </button>
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="Delete">
                                <th mat-header-cell *matHeaderCellDef></th>
                                <td mat-cell *matCellDef="let controller">

                                  <!-- This is where we have to add the function to delete the controller -->
                                  <button mat-button color="warn" aria-label="Delete controller" matTooltip="Delete controller" (click)="DeleteGSM(controller)">
                                    <mat-icon>delete</mat-icon>
                                  </button>
                                </td>
                              </ng-container>

                              <tr mat-header-row *matHeaderRowDef="controllerColumns.concat(['Update', 'Delete'])"></tr>
                              <tr mat-row *matRowDef="let controller; columns: controllerColumns.concat(['Update', 'Delete'])"
                                  class="controller-row">
                              </tr>
                            </table>

                            <!-- This is where we have to add the function to create a new controller-->
                            <button mat-mini-fab class="addButton" color="basic" aria-label="Add controller" matTooltip="Add controller" (click)="AddGSM()">
                              <mat-icon>add</mat-icon>
                            </button>

                          </div>
                        </div>
                      </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="roomColumns.concat(['Update', 'Delete'])"></tr>
                    <tr mat-row *matRowDef="let room; columns: roomColumns.concat(['Update', 'Delete']);"
                        class="room-row"
                        [class.example-expanded-row]="roomColumns.concat(['Update', 'Delete']) === room"
                        (click)="toggleRooms(room)">
                    </tr>
                    <tr mat-row *matRowDef="let row; columns: ['expandedRoom']" class="detail-row"></tr>
                  </table>

                  <!-- This is where we have to add the function to create a new room-->
                  <button (click)="addRoom()" mat-mini-fab class="addButton" color="basic" aria-label="Add room" matTooltip="Add room">
                    <mat-icon>add</mat-icon>
                  </button>

                </div>
                <div class="buttons">

                  <!-- This is where we have to add the function to delete the location -->
                  <button mat-fab color="warn" aria-label="Delete location" matTooltip="Delete location" (click)="deleteLocation(location)">
                    <mat-icon>delete</mat-icon>
                  </button>

                  <!-- This is where we have to add the function to update the location -->
                  <button mat-fab color="basic" aria-label="Update location" matTooltip="Update location" (click)="updateLocation(location)">
                    <mat-icon>create</mat-icon>
                  </button>
                </div>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="locationColumns"></tr>
          <tr mat-row *matRowDef="let location; columns: locationColumns;"
              class="location-row"
              [class.example-expanded-row]="locationColumns === location"
              (click)="toggleLocationRow(location)">
          </tr>
          <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
        </table>
        <!--This is where we have to add the create functionality to the button-->
        <button mat-mini-fab class="addButton" color="basic" aria-label="Add location" matTooltip="Add location" (click)="addLocation()">
          <mat-icon>add</mat-icon>
        </button>
      </div>


      <!--PAST ACTIONS IN APP SECTION-->
      <div class="pastActions" *ngIf="isPastActions()">
        <!--loading spinner-->
        <div class = "loading" *ngIf="isLoadingResults">
          <div class="container" *ngIf="isLoadingResults">
            <div class="row">
              <div id="loader">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="loading"></div>
              </div>
            </div>
          </div>
        </div>
        <!--filter field-->
        <mat-form-field *ngIf="!isLoadingResults" class="actions-form-field">
          <mat-label>Filter actions</mat-label>
          <input matInput (keyup)="applyFilterActions($event)" placeholder="Filter by any criteria" #input>
        </mat-form-field>
        <!--table-->
        <table mat-table *ngIf="!isLoadingResults" [dataSource]="dataSourceActions" matSort matSortActive="created" matSortDisableClear matSortDirection="desc" class="pastActionsTable">
          <!-- Operation Type Column -->
          <ng-container matColumnDef="operationType">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Operation Type </th>
            <td mat-cell *matCellDef="let element"> {{element.operationType}} </td>
          </ng-container>

          <!-- DateTime Column -->
          <ng-container matColumnDef="dateTime">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Date&Time </th>
            <td mat-cell *matCellDef="let element"> {{element.dateTime}} </td>
          </ng-container>


          <!-- GSMController name Column -->
          <ng-container matColumnDef="gsmControllerName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> GSM Name </th>
            <td mat-cell *matCellDef="let element"> {{element.gsmControllerName}} </td>
          </ng-container>

          <!-- GSMController type Column -->
          <ng-container matColumnDef="gsmControllerType">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Type </th>
            <td mat-cell *matCellDef="let element"> {{element.gsmControllerType}} </td>
          </ng-container>

          <!-- Room Name Column -->
          <ng-container matColumnDef="roomName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Room </th>
            <td mat-cell *matCellDef="let element"> {{element.roomName}} </td>
          </ng-container>

          <!-- Location Name Column -->
          <ng-container matColumnDef="locationName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Location </th>
            <td mat-cell *matCellDef="let element"> {{element.locationName}} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
        <mat-paginator *ngIf="!isLoadingResults" [length]="resultsActionLength" [pageSize]="5" [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
        <button class="export" mat-button (click)="exportInfo()">Export info</button>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>
